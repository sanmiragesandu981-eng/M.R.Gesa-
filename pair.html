<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAIR CODE - ü§ñ M.R.Gesa</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
    body { display:flex; justify-content:center; align-items:center; height:100vh; margin:0; font-family:'Arial', sans-serif; color:#fff; background:url('https://static.vecteezy.com/system/resources/thumbnails/012/396/675/small_2x/cybersecurity-modern-technology-background-with-padlock-vector.jpg') no-repeat center center/cover; }
    .container { display:flex; flex-direction:column; align-items:center; }
    .box { width:320px; padding:20px; text-align:center; background:rgba(0,0,0,0.8); border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.7);}
    .input-container { display:flex; background:#000; border-radius:1rem; padding:0.3rem; gap:0.3rem; }
    .input-container input { flex:75%; padding:1rem; border:none; border-radius:0.8rem 0 0 0.8rem; color:#fff; }
    .input-container button { flex:25%; padding:1rem; background:#25d366; color:white; border:none; border-radius:0 0.8rem 0.8rem 0; font-weight:900; cursor:pointer;}
    .input-container button:hover { background:#2980b9; }
    #loading-spinner { display:none; margin-top:10px; }
    .fa-spinner { animation:spin 2s linear infinite; }
    @keyframes spin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
    #pair { margin-top:10px; text-align:center; }
  </style>
</head>
<body>
<div class="container">
  <div class="box">
    <h3>Link M.R.Gesa with phone number</h3>
    <p>üî¢ Enter your number with country code</p>
    <div class="input-container">
      <input type="number" id="number" placeholder="+94704xxxxxx">
      <button id="submit">Submit</button>
    </div>
    <div id="loading-spinner"><i class="fas fa-spinner fa-spin"></i></div>
    <main id="pair"></main>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
<script>
let pairDiv = document.getElementById("pair");
let submitBtn = document.getElementById("submit");
let numberInput = document.getElementById("number");

async function copyCode(){
  let copyText = document.getElementById("copy").innerText.replace("CODE: ","");
  await navigator.clipboard.writeText(copyText);
  let obj = document.getElementById("copy");
  obj.innerText="‚úîÔ∏è COPIED";
  obj.style.color="blue";
  setTimeout(()=>{ obj.innerText="CODE: "+copyText; obj.style.color="white"; },1000);
}

submitBtn.addEventListener("click", async (e)=>{
  e.preventDefault();
  pairDiv.innerHTML="";
  if(!numberInput.value){ pairDiv.innerHTML='<p style="color:red">‚ùóEnter your WhatsApp number with country code.</p>'; return; }
  if(numberInput.value.replace(/[^0-9]/g,"").length<11){ pairDiv.innerHTML='<p style="color:red">‚ùóInvalid number format.</p>'; return; }

  const cleanNumber = numberInput.value.replace(/[^0-9]/g,"");
  document.getElementById("loading-spinner").style.display="block";

  try{
    let {data} = await axios(`/code?number=${cleanNumber}`);
    let code = data.code || "‚ùó Service Unavailable";
    pairDiv.innerHTML=`<span id="copy" onclick="copyCode()" style="color:blue; cursor:pointer;">CODE: ${code}</span>`;
  }catch(e){
    pairDiv.innerHTML='<p style="color:red">‚ùó Error contacting server.</p>';
  }finally{
    document.getElementById("loading-spinner").style.display="none";
  }
});
</script>
</body>
</html>
